<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../mixins/redux-mixin.html">
<link rel="import" href="hoverboard-icons.html">

<dom-module id="map-block">
    <template>
        <style is="custom-style" include="shared-styles flex flex-alignment positioning"></style>

        <style>
             :host {
                display: block;
                margin: 40px 0;
                position: relative;
                overflow: hidden;
                height: 500px;     
            } 

            google-map {
                height: 540px;
            }

            [slot="markers"]  {
                display: block;
            }

            .card-wrapper {
                height: 100%;
                padding-bottom: 0;
                padding-top: 0;
                padding-left: 0;
                padding-left: 16px;
    height: 100%;
                /*position: relative;*/
            }

            .container {
                position: relative;
            }



            .card-content {
                padding: 0 8px;
            }          

            .card {   
                min-width: 320px;
                max-width: 360px;
                background: var(--primary-background-color);
                position: relative;

                height: 553px;

                --paper-card-header-text: {
                    color: #fff;
                    font-weight: 400;
                    font-family: var(--font-family);
                };

                --paper-card-header-image: {
                    max-height: 200px;
                    transition: background-image 1s ease-in-out;
                    will-change: background-image
                };

                --paper-card-content: {
                    max-height: 215px;
                }    

                height: 500px;         
            }   

            .direction-button paper-fab {
                background: #fff;
                color: inherit;
                pointer-events: all;
                box-shadow: 0 0 8px 0 rgba(0,0,0,0.12), 0 8px 8px 0 rgba(0,0,0,0.24);
            }   

            .direction-button {
                position: absolute;
                pointer-events: none;
                z-index: 1;
                right: 8px;
                top: 50%;
                transform: translate3d(0, -50%, 0);
            }

            .card-content {
                padding: 32px 8px 0;
            } 

            paper-icon-item {
                --paper-item-disabled-color: var(--secondary-text-color);
            }

            paper-icon-item iron-icon {
                --iron-icon-fill-color: var(--default-primary-color);
            }

            .image-overlay {
               background-color: rgba(0, 0, 0, 0.1);
            }
            
            @media (min-width: 640px) {

                google-map {
                    height: 520px;
                }

                .card {
                    box-shadow: 24px 0 35px rgba(0, 0, 0, 0.5);
                }

                .card-content {
                    padding-right: 8px;
                    padding-left: 8px;
                    padding: 24px 8px 0;
                } 

                .direction-button {       
                    right: 0;
                    transform: translate3d(30%, -50%, 0);
                }
            }

        </style>
       <div class="container" layout horizantal>
 <google-map
            zoom="{$ location.pointer.zoom $}"
            latitude="{$ location.mapCenter.latitude $}"
            longitude="{$ location.mapCenter.longitude $}"
            api-key="{$ location.apiKey $}"
            styles="[[options]]"
            disable-zoom disable-default-ui layout>
        <google-map-marker slot="markers"
          latitude="{$ location.pointer.latitude $}"
          longitude="{$ location.pointer.longitude $}">
        </google-map-marker>
        <div class="image-overlay" fit></div>

      </google-map>

        <div class="disable-map-events" fit></div>
        <div class="card-wrapper" layout horizontal flex start-justified end$="[[!viewport.isPhone]]" center$="[[viewport.isPhone]]" fit>
            <paper-card class="card" heading="{$ location.name $}" fade-image preload-image>
                <a class="direction-button"
                    href="https://www.google.com/maps/dir/{$ location.pointer.latitude $},{$ location.pointer.longitude $}/@{$ location.pointer.latitude $},{$ location.pointer.longitude $},18z"
                    target="_blank" rel="noopener noreferrer">
                    <paper-fab icon="hoverboard:directions"></paper-fab>
                </a>
                <div class="card-content list">
                    <paper-icon-item disabled>
                        <iron-icon icon="hoverboard:feedback" slot="item-icon"></iron-icon>
                        <paper-item-body>{$ location.description $}</paper-item-body>
                    </paper-icon-item>
                    <paper-icon-item disabled slot="item-icon">
                        <iron-icon icon="hoverboard:location" slot="item-icon"></iron-icon>
                        <paper-item-body two-line>
                            <div>{$ location.streetAddress $}</div>
                            <div secondary>{$ location.short $}</div>
                        </paper-item-body>
                    </paper-icon-item>
                </div>
            </paper-card>
        </div>

       </div>

       
    </template>

    <script>
        class MapBlock extends  ReduxMixin(Polymer.Element) {
            static get is() { return 'map-block' }

            static get properties() {
                return {
                    options: {
                        type: String,
                        value: function () {
                        return [{
                            stylers: [{
                            'lightness': 40
                            }, {
                            'visibility': 'on'
                            }, {
                            'gamma': 0.9
                            }, {
                            'weight': 0.4
                            }]
                        }, {
                            'elementType': 'labels',
                            'stylers': [{
                            'visibility': 'on'
                            }]
                        }, {
                            'featureType': 'water',
                            'stylers': [{
                            'color': '{$ location.mapColor $}'
                            }]
                        }];
                        }
                    },
                    
                    images: {
                        type: Array,
                        value: {$ location.images | dump | safe $}
                    },
                    _currentSourceIndex: {
                        type: Number,
                        value: 0
                    },
                    _currentImage: {
                        type: String
                    },
                    viewport: {
                        type: Object,
                        statePath: 'ui.viewport'
                    }
                }
            }

            //   ready() {
               
            // }

            //  previousImage() {
            //     this._currentSourceIndex = (this._currentSourceIndex > 0) ? this._currentSourceIndex - 1 : this.images.length - 1;
            //     this._currentImage = this.images[this._currentSourceIndex];
            // }

            // nextImage() {
            //     this._currentSourceIndex = (this._currentSourceIndex < this.images.length - 1) ? this._currentSourceIndex + 1 : 0;
            //     this._currentImage = this.images[this._currentSourceIndex];
            // }
        }

        customElements.define(MapBlock.is, MapBlock);
    </script>
</dom-module>
